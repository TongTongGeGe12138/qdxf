import{O as b,r as w}from"./index-Bz-KOdQ0.js";import{k as u}from"./vendor-D1U3vd9f.js";const k="/assets/upload-cloud-2-line.svg",A="/assets/close-circle-fill.svg",$="/assets/check-double-fill.svg";function G(){const g={"pdf-to-dwg":{startPath:e=>`/file/${e}/convert/pdf/to/dwg`,downloadPath:e=>`/api/file/${e}/dwg/download`},"dwg-to-pdf":{startPath:e=>`/file/${e}/convert/dwg/to/pdf`,downloadPath:e=>`/api/file/${e}/pdf/download`},"dwg-to-svg":{startPath:e=>`/file/${e}/convert/dwg/to/svg`,downloadPath:e=>`/api/file/${e}/svg/download`},"dwg-to-png":{startPath:e=>`/file/${e}/convert/dwg/to/png`,downloadPath:e=>`/api/file/${e}/png/download`}},l=u(null),r=u(null),c=u(0),t=u("idle"),o=u(null),i=u(null),s=u("pdf-to-dwg");let n=null;const h={exportAllLayouts:!1,layouts:null,zoomToExtents:!0,paper:"custom",orientation:"auto",paperWidthMm:1188,paperHeightMm:1682,geomDpi:600,colorDpi:null,bwDpi:null,embedTtf:!1,embedTtfOptimized:!1,ttfAsGeometry:!1,shxAsGeometry:!1,searchableTtf:!1,searchableShx:!1,enableLayers:!0,includeOffLayers:!1,solidHatchMode:null,gradientHatchMode:null,extentsBoundingBox:!1,flateCompression:!0,asciiHexEncoding:!1,useHLR:!1,exportHyperlinks:!0,linearized:!1,measuring:!0,geoMeasure:!1,colorPolicy:"asis",pdfa:"none",splitLayoutsZip:!0},m={exportAllLayouts:!1,layouts:null,splitLayoutsZip:!0,zoomToExtents:!0,width:4096,height:4096,palette:"light",hatchAsPolygon:!0,plotLineweights:!0,imageBase:"",imageUrl:"",defaultImageExt:".png",minimalWidth:.1,lineWeightScale:1,colorPolicy:0},y={exportAllLayouts:!1,layouts:null,splitLayoutsZip:!0,zoomToExtents:!0,width:4096,height:4096,scaleMode:"cover",transparentBackground:!1,backgroundColor:"#FFFFFF"};async function f(e){t.value="uploading",o.value=null,c.value=0,l.value=null,r.value=null,i.value=null;try{const d=new FormData;d.append("file",e,(e==null?void 0:e.name)||"upload.bin");const a=await b(d);if(a.success&&a.data&&a.data.fileId)l.value=a.data.fileId,t.value="converting",await x();else throw new Error(a.error||"上传失败")}catch(d){t.value="failed",o.value=d.message||"上传失败"}}async function T(e){return p("pdf-to-dwg"),f(e)}async function P(e){return p("dwg-to-pdf"),f(e)}async function _(e){return p("dwg-to-svg"),f(e)}async function D(e){return p("dwg-to-png"),f(e)}async function x(){if(l.value)try{const e=g[s.value].startPath(l.value),d=s.value==="dwg-to-pdf"?h:s.value==="dwg-to-svg"?m:s.value==="dwg-to-png"?y:void 0,a=await w.post({url:e,data:d});if(a.success&&a.data&&a.data.taskId)r.value=a.data.taskId,t.value="processing",v();else throw new Error(a.error||"发起转换失败")}catch(e){t.value="failed",o.value=e.message||"发起转换失败"}}async function v(){if(r.value){n&&clearTimeout(n);try{const e=await w.get({url:`/file/task/${r.value}/status`});if(e.success&&e.data){if(c.value=e.data.progress,c.value===100){t.value="success",i.value=g[s.value].downloadPath(l.value);return}else if(e.data.status==="failed"){t.value="failed",o.value=e.data.errorMessage||"转换失败";return}}n=setTimeout(v,1500)}catch(e){t.value="failed",o.value=e.message||"查询进度失败"}}}function F(){i.value&&window.open("https://api-work.beesfpd.com"+i.value,"_self")}function O(){n&&clearTimeout(n)}function L(){l.value=null,r.value=null,c.value=0,t.value="idle",o.value=null,i.value=null,n&&clearTimeout(n)}function p(e){s.value=e}return{fileId:l,taskId:r,progress:c,status:t,errorMessage:o,downloadUrl:i,convertDirection:s,setConvertDirection:p,handleUpload:f,uploadPdfToDwg:T,uploadDwgToPdf:P,uploadDwgToSvg:_,uploadDwgToPng:D,download:F,cleanup:O,reset:L}}export{k as _,A as a,$ as b,G as u};
